# 7.17测试

3602，从ExecAfterMarketData刚进入到OnTick调用之前

## 原双vector加锁



| 样本容量 | 延迟平均   |
| ---- | ------ |
| 1e4  | 338603 |
|      | 11233  |
|      | 10687  |
|      | 10486  |
|      | 11169  |
|      | 14417  |
|      | 12310  |
|      | 10739  |
|      | 10112  |
|      | 10096  |
|      | 12222  |
|      | 10183  |
| 1e5  | 10691  |
|      | 10726  |
|      | 10760  |
|      | 10278  |
|      | 12457  |
|      | 13091  |
|      | 10499  |
|      | 10072  |
|      | 11093  |
|      | 10749  |



## concurrentqueue

<table><thead><tr><th width="353">样本容量</th><th>延迟</th></tr></thead><tbody><tr><td>1e4</td><td>2929</td></tr><tr><td></td><td>2648</td></tr><tr><td></td><td>2851</td></tr><tr><td></td><td>33347(确实5位数，奇怪）</td></tr><tr><td></td><td>2770</td></tr><tr><td></td><td>2797</td></tr><tr><td></td><td>2586</td></tr><tr><td></td><td>2498</td></tr><tr><td></td><td>2610</td></tr><tr><td></td><td>3044</td></tr><tr><td>1e5</td><td>2751</td></tr><tr><td></td><td>2987</td></tr><tr><td></td><td>2727</td></tr><tr><td></td><td>3043</td></tr><tr><td></td><td>2733</td></tr><tr><td></td><td>2914</td></tr><tr><td></td><td>2960</td></tr><tr><td></td><td>2637</td></tr><tr><td></td><td>2587</td></tr><tr><td></td><td>2955</td></tr></tbody></table>

## aotmicqueue

| 样本容量 | 平均延时 |
| ---- | ---- |
| 1e5  | 3062 |
|      | 2934 |
|      | 2920 |
|      | 2714 |
|      | 3065 |
|      | 3195 |
|      | 2748 |
|      | 2846 |
|      | 2909 |
|      | 2868 |
| 1e4  | 3022 |
|      | 2640 |
|      | 2732 |
|      | 2670 |
|      | 2631 |
|      | 2627 |
|      | 2778 |
|      | 2583 |
|      | 2801 |
|      | 2524 |

从push\_back之前到pop之后，3602，延迟单位为纳秒

## concurrentqueue

| 样本容量 | 平均延时  |
| ---- | ----- |
| 1e4  | 1302  |
|      | 4070  |
|      | 1276  |
|      | 1350  |
|      | 1287  |
|      | 1316  |
|      | 15239 |
|      | 1253  |
|      | 9970  |
|      | 1189  |
| 1e5  | 1306  |
|      | 1354  |
|      | 1307  |
|      | 1264  |
|      | 1400  |
|      | 1302  |
|      | 1360  |
|      | 1257  |
|      | 2205  |
|      | 1207  |

## atomicqueue

| 样本容量 | 平均延时 |
| ---- | ---- |
| 1e4  | 1426 |
|      | 1224 |
|      | 1472 |
|      | 1343 |
|      | 1296 |
|      | 1290 |
|      | 1402 |
|      | 1231 |
|      | 1204 |
|      | 1336 |
| 1e5  | 1335 |
|      | 1225 |
|      | 1246 |
|      | 1297 |
|      | 1261 |
|      | 1278 |
|      | 1276 |
|      | 1335 |
|      | 1355 |
|      | 1370 |

## 原双vector加锁

| 样本容量 | 平均延时  |
| ---- | ----- |
| 1e4  | 8682  |
|      | 8631  |
|      | 9713  |
|      | 11544 |
|      | 8906  |
|      | 8750  |
|      | 8860  |
|      | 8565  |
|      | 25214 |
|      | 13144 |
|      | 9628  |
|      | 10269 |
|      | 8666  |
|      | 8940  |
|      | 8859  |
|      | 8708  |
|      | 9317  |
|      | 8558  |
|      | 10405 |

## 结果截图

3602,从push\_back前到pop后，atomic和concurrentqueue都是1e5取平均值取一百次进行统计，原双vector加锁方案较慢1e4取平均值取一百次进行统计。由于双vector加锁方案没有显式意义上的pop，取“在for遍历tmPriceList时对每个MULTIDATA的元素使用前”为pop后时间戳。

<figure><img src="../.gitbook/assets/image (61).png" alt=""><figcaption></figcaption></figure>
